(function(a){a.extend(a.fn,{XAutoSuggest:function(d){var c=a.extend({url:"http://portal.xiu.com/business/XAutoSuggest?jsoncallback=?",maxNum:10,width:0,leftOff:0,topOff:0,minChars:1,scrollHeight:850,showOnFocus:false},d);if(typeof c.url!="string"){return}var e=a(this);var b=a(this).val();b=!!b?b:"";e.autocompleteLeon(c.url,{max:c.maxNum,minChars:c.minChars,params:c.params,matchContains:false,width:c.width,leftOff:c.leftOff,topOff:c.topOff,selectFirst:false,initialValue:b,showOnFocus:c.showOnFocus,scrollHeight:c.scrollHeight,formatItem:function(l,j,f,k,h){l._index=j;var g="";if(!!l.display){if(l.type==1){g+="<span>"+l.display+'</span><span class="leon-s-oclass">\u5728<span class="leon-fb">'+l.oclassName+"</span>\u5206\u7c7b\u4e0b\u641c\u7d22</span>"}else{g+="<span>"+l.display+"</span>";if(!!l.count){g+='<span class="leon-s-gn">\u7ea6'+l.count+"\u4ef6\u5546\u54c1</span>"}}}return g},formatResult:function(f){return f.display}}).result(function(f,h,g){if(typeof c.result=="function"){c.result(h)}})}});a.fn.extend({autocompleteLeon:function(b,c){var d=typeof b=="string";c=a.extend({},a.Autocompleter.defaults,{url:d?b:null,data:d?null:b,delay:d?a.Autocompleter.defaults.delay:10,max:c&&!c.scroll?10:150},c);c.highlight=c.highlight||function(e){return e};c.formatMatch=c.formatMatch||c.formatItem;return this.each(function(){new a.Autocompleter(this,c)})},result:function(b){return this.bind("result",b)},search:function(b){return this.trigger("search",[b])},flushCache:function(){return this.trigger("flushCache")},setOptions:function(b){return this.trigger("setOptions",[b])},unautocomplete:function(){return this.trigger("unautocomplete")}});a.Autocompleter=function(n,h){var c={UP:38,DOWN:40,DEL:46,TAB:9,RETURN:13,ESC:27,COMMA:188,PAGEUP:33,PAGEDOWN:34,BACKSPACE:8};var b=a(n).attr("autocomplete","off").addClass(h.inputClass);var l;var s=h.initialValue;var o=a.Autocompleter.Cache(h);var f=0;var j=true;var w;var z={mouseDownOnSelect:false};var t=a.Autocompleter.Select(h,n,e,z);var y;var d;a.browser.opera&&a(n.form).bind("submit.autocomplete",function(){if(y){y=false;return false}});b.bind((a.browser.opera?"keypress":"keydown")+".autocomplete",function(A){w=A.keyCode;switch(A.keyCode){case c.UP:A.preventDefault();if(t.visible()){t.prev()}else{v(0,true)}break;case c.DOWN:A.preventDefault();if(t.visible()){t.next()}else{v(0,true)}break;case c.PAGEUP:A.preventDefault();if(t.visible()){t.pageUp()}else{v(0,true)}break;case c.PAGEDOWN:A.preventDefault();if(t.visible()){t.pageDown()}else{v(0,true)}break;case h.multiple&&a.trim(h.multipleSeparator)==","&&c.COMMA:case c.TAB:case c.RETURN:if(e()){A.preventDefault();y=true;return false}break;case c.ESC:t.hide();break;default:if(!a.browser.mozilla){clearTimeout(l);l=setTimeout(v,h.delay)}break}}).focus(function(){if(h.showOnFocus&&j){v(0,true);j=false}f++}).blur(function(){f=0;j=true;if(!z.mouseDownOnSelect){u()}if(typeof h.blurAutoMatchDo=="function"){if(d&&d.length==1&&d[0].result==i(b.val())){h.blurAutoMatchDo(d,b)}}}).click(function(){if(f++>1&&!t.visible()){v(0,true)}}).bind("search",function(){var A=(arguments.length>1)?arguments[1]:null;function B(F,E){var C;if(E&&E.length){for(var D=0;D<E.length;D++){if(E[D].result.toLowerCase()==F.toLowerCase()){C=E[D];break}}}if(typeof A=="function"){A(C)}else{b.trigger("result",C&&[C.data,C.value])}}a.each(i(b.val()),function(C,D){g(D,B,B)})}).bind("flushCache",function(){o.flush()}).bind("setOptions",function(){a.extend(h,arguments[1]);if("data" in arguments[1]){o.populate()}}).bind("unautocomplete",function(){t.unbind();b.unbind();a(n.form).unbind(".autocomplete")}).bind("input",function(){if(a.browser.mozilla){clearTimeout(l);l=setTimeout(v,h.delay)}});function e(){var B=t.selected();if(!B){return false}var A=B.result;s=A;if(h.multiple){var C=i(b.val());if(C.length>1){A=C.slice(0,C.length-1).join(h.multipleSeparator)+h.multipleSeparator+A}A+=h.multipleSeparator}b.val(A);x();b.trigger("result",[B.data,B.value]);return true}function v(C,B){if(w==c.DEL){t.hide()}var A=b.val();if(!B&&A==s){return}if(h.beginChangeDo){h.beginChangeDo(b)}s=A;A=k(A);if(A.length>=h.minChars||(A.length==0&&h.showOnFocus)){b.addClass(h.loadingClass);if(!h.matchCase){A=A.toLowerCase()}g(A,m,x)}else{p();t.hide()}}function i(B){if(!B){return[""]}var C=B.split(h.multipleSeparator);var A=[];a.each(C,function(D,E){if(a.trim(E)){A[D]=a.trim(E)}});return A}function k(A){if(!h.multiple){return A}var B=i(A);return B[B.length-1]}function r(A,B){if(h.autoFill&&(k(b.val()).toLowerCase()==A.toLowerCase())&&w!=c.BACKSPACE){b.val(b.val()+B.substring(k(s).length));a.Autocompleter.Selection(n,s.length,s.length+B.length)}}function u(){clearTimeout(l);l=setTimeout(x,200)}function x(){var A=t.visible();t.hide();clearTimeout(l);p();if(h.mustMatch){b.search(function(B){if(!B){if(h.multiple){var C=i(b.val()).slice(0,-1);b.val(C.join(h.multipleSeparator)+(C.length?h.multipleSeparator:""))}else{b.val("")}}})}if(A){j=false;a.Autocompleter.Selection(n,n.value.length,n.value.length)}else{j=true}}function m(B,A){if((A&&A.length&&(f||(h.showOnFocus&&j)))){p();t.display(A,B);r(B,A[0].value);t.show()}else{x()}}function g(B,D,A){if(!h.matchCase){B=B.toLowerCase()}var C=o.load(B);if(C&&C.length){d=C;D(B,C)}else{if((typeof h.url=="string")&&(h.url.length>0)){var E=a.extend({timestamp:+new Date()},h.params);a.each(h.extraParams,function(F,G){E[F]=typeof G=="function"?G():G});a.ajax({mode:"abort",port:"autocomplete"+n.name,dataType:h.dataType,url:h.url,data:a.extend({q:encodeURI(k(B),"utf-8"),limit:h.max},E),success:function(G){var F=h.parse&&h.parse(G)||q(G);d=F;o.add(B,F);D(B,F)}})}else{t.emptyList();A(B)}}}function q(D){var A=[];var C=D;if(C!=null){for(var B=0;B<C.length;B++){var E=C[B];if(E){A[A.length]={data:E,value:E.matchvalue,result:h.formatResult&&h.formatResult(E,E[0])||E[0]}}}}return A}function p(){b.removeClass(h.loadingClass)}};a.Autocompleter.defaults={inputClass:"leon-autosug_input",resultsClass:"leon-autosug-style",loadingClass:"leon-autosug-loading",minChars:1,delay:50,initialValue:"",matchCase:false,matchSubset:true,matchContains:false,cacheLength:30,max:100,dataType:"jsonp",mustMatch:false,extraParams:{},selectFirst:true,formatItem:function(b){return b[0]},formatMatch:null,autoFill:false,width:0,leftOff:0,topOff:0,multiple:false,multipleSeparator:", ",blurAutoMatchDo:null,showOnFocus:false,highlight:function(c,b){return c.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+b.replace(/([\^\$\(\)\[\]\{\}\*\.\+\?\|\\])/i,"\\$1")+")(?![^<>]*>)(?![^&;]+;)","i"),"<font>$1</font>")},scroll:true,scrollHeight:180};a.Autocompleter.Cache=function(c){var f={};var d=0;function h(l,k){if(!l){return false}if(!c.matchCase){l=l.toLowerCase()}var j=l.indexOf(k);if(c.matchContains=="word"){j=l.toLowerCase().search("\\b"+k.toLowerCase())}if(j==-1){return false}return j==0||c.matchContains}function g(j,i){if(d>c.cacheLength){b()}if(!f[j]){d++}f[j]=i}function e(){if(!c.data){return false}var k={},j=0;if(!c.url){c.cacheLength=1}k[""]=[];for(var m=0,l=c.data.length;m<l;m++){var p=c.data[m];p=(typeof p=="string")?[p]:p;var o=c.formatMatch(p,m+1,c.data.length);if(o===false){continue}var n=o.charAt(0).toLowerCase();if(!k[n]){k[n]=[]}var q={value:o,data:p,result:c.formatResult&&c.formatResult(p)||o};k[n].push(q);if(j++<c.max){k[""].push(q)}}a.each(k,function(r,s){c.cacheLength++;g(r,s)})}setTimeout(e,25);function b(){f={};d=0}return{flush:b,add:g,populate:e,load:function(n){if(!c.cacheLength||!d){return null}if(!c.url&&c.matchContains){var m=[];for(var j in f){if(j.length>0){var o=f[j];a.each(o,function(p,k){if(h(k.value,n)){m.push(k)}})}}return m}else{if(f[n]){return f[n]}else{if(c.matchSubset){for(var l=n.length-1;l>=c.minChars;l--){var o=f[n.substr(0,l)];if(o){var m=[];a.each(o,function(p,k){if(h(k.value,n)){m[m.length]=k}});return m}}}}}return null}}};a.Autocompleter.Select=function(e,j,l,p){var i={ACTIVE:"autosug-over"};var k,f=-1,r,m="",s=true,c,o;function n(){if(!s){return}c=a("<div/>").hide().addClass(e.resultsClass).css("position","absolute").appendTo(document.body);o=a("<ul/>").appendTo(c).mouseover(function(t){if(q(t).nodeName&&q(t).nodeName.toUpperCase()=="LI"){f=a("li",o).removeClass(i.ACTIVE).index(q(t));a(q(t)).addClass(i.ACTIVE)}}).click(function(t){a(q(t)).addClass(i.ACTIVE);l();j.focus();return false}).mousedown(function(){p.mouseDownOnSelect=true}).mouseup(function(){p.mouseDownOnSelect=false});if(e.width>0){c.css("width",e.width)}s=false}function q(u){var t=u.target;while(t&&t.tagName!="LI"){t=t.parentNode}if(!t){return[]}return t}function h(t){k.slice(f,f+1).removeClass(i.ACTIVE);g(t);var v=k.slice(f,f+1).addClass(i.ACTIVE);if(e.scroll){var u=0;k.slice(0,f).each(function(){u+=this.offsetHeight});if((u+v[0].offsetHeight-o.scrollTop())>o[0].clientHeight){o.scrollTop(u+v[0].offsetHeight-o.innerHeight())}else{if(u<o.scrollTop()){o.scrollTop(u)}}}}function g(t){f+=t;if(f<0){f=k.size()-1}else{if(f>=k.size()){f=0}}}function b(t){return e.max&&e.max<t?e.max:t}function d(){o.empty();var u=b(r.length);for(var v=0;v<u;v++){if(!r[v]){continue}var w=e.formatItem(r[v].data,v+1,u,r[v].value,m);if(w===false){continue}var t=a("<li/>").html(e.highlight(w,m)).addClass(v%2==0?"autosug_even":"autosug_odd").appendTo(o)[0];a.data(t,"ac_data",r[v])}k=o.find("li");if(e.selectFirst){k.slice(0,1).addClass(i.ACTIVE);f=0}if(a.fn.bgiframe){o.bgiframe()}}return{display:function(u,t){n();r=u;m=t;d()},next:function(){h(1)},prev:function(){h(-1)},pageUp:function(){if(f!=0&&f-8<0){h(-f)}else{h(-8)}},pageDown:function(){if(f!=k.size()-1&&f+8>k.size()){h(k.size()-1-f)}else{h(8)}},hide:function(){c&&c.hide();k&&k.removeClass(i.ACTIVE);f=-1},visible:function(){return c&&c.is(":visible")},current:function(){return this.visible()&&(k.filter("."+i.ACTIVE)[0]||e.selectFirst&&k[0])},show:function(){var v=a(j).offset();c.css({width:typeof e.width=="string"||e.width>0?e.width:a(j).width(),top:v.top+j.offsetHeight+e.topOff,left:v.left+e.leftOff}).show();if(e.scroll){o.scrollTop(0);o.css({maxHeight:e.scrollHeight,overflow:"auto"});if(a.browser.msie&&typeof document.body.style.maxHeight==="undefined"){var t=0;k.each(function(){t+=this.offsetHeight});var u=t>e.scrollHeight;o.css("height",u?e.scrollHeight:t);if(!u){k.width(o.width()-parseInt(k.css("padding-left"))-parseInt(k.css("padding-right")))}}}},selected:function(){var t=k&&k.filter("."+i.ACTIVE).removeClass(i.ACTIVE);return t&&t.length&&a.data(t[0],"ac_data")},emptyList:function(){o&&o.empty()},unbind:function(){c&&c.remove()}}};a.Autocompleter.Selection=function(d,e,c){if(d.createTextRange){var b=d.createTextRange();b.collapse(true);b.moveStart("character",e);b.moveEnd("character",c);b.select()}else{if(d.setSelectionRange){d.setSelectionRange(e,c)}else{if(d.selectionStart){d.selectionStart=e;d.selectionEnd=c}}}d.focus()}})(jQuery);
