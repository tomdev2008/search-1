<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="XIU_CATALOG">


	<resultMap id="getAllLevel3CatalogByDB_BaseResultMap" type="com.xiu.search.dao.model.XiuCatalogDBModel">
		<result column="CLASS_ID" property="catId" jdbcType="INTEGER" />
		<result column="CLASS_NAME" property="catName" jdbcType="VARCHAR" />
		<result column="CLASS_RANK" property="catRank" jdbcType="INTEGER" />
		<result column="CLASS_PROVIDER_CODE" property="catProviderCode" jdbcType="VARCHAR" />
		<result column="PAR_CLASS1_ID" property="parCatId1" jdbcType="INTEGER" />
		<result column="PAR_CLASS2_ID" property="parCatId2" jdbcType="INTEGER" />
		<result column="PAR_CLASS1_NAME" property="parCatName1" jdbcType="VARCHAR" />
		<result column="PAR_CLASS2_NAME" property="parCatName2" jdbcType="VARCHAR" />
		<result column="PAR_CLASS1_RANK" property="parCatRank1" jdbcType="INTEGER" />
		<result column="PAR_CLASS2_RANK" property="parCatRank2" jdbcType="INTEGER" />
		<result column="PAR_CLASS3_DISPLAY" property="display3" jdbcType="VARCHAR" />
		<result column="PAR_CLASS2_DISPLAY" property="display2" jdbcType="VARCHAR" />
		<result column="PAR_CLASS1_DISPLAY" property="display1" jdbcType="VARCHAR" />
	</resultMap>


	<select id="getAllLevel3CatalogByDB" parameterType="java.lang.Long"
		resultMap="getAllLevel3CatalogByDB_BaseResultMap">
		SELECT
		GRP3.CATGROUP_ID CLASS_ID,
		<!-- GRP3.IDENTIFIER CLASS_CODE, -->
		CGN3.NAME CLASS_NAME,
		GRP3.RANK CLASS_RANK,
		XSCC.FIELD3 CLASS_PROVIDER_CODE,
		GRP1.CATGROUP_ID PAR_CLASS1_ID,
		GRP2.CATGROUP_ID PAR_CLASS2_ID,
		<!-- GRP1.IDENTIFIER PAR_CLASS1_CODE, -->
		<!-- GRP2.IDENTIFIER PAR_CLASS2_CODE, -->
		CGN1.NAME PAR_CLASS1_NAME,
		CGN2.NAME PAR_CLASS2_NAME,
		GRP1.RANK PAR_CLASS1_RANK ,
		GRP2.RANK PAR_CLASS2_RANK,
		CGN1.DISPLAY PAR_CLASS1_DISPLAY,
    	CGN2.DISPLAY PAR_CLASS2_DISPLAY,
    	CGN3.DISPLAY PAR_CLASS3_DISPLAY   
		FROM CATGROUP GRP3
		LEFT JOIN CATGRPDESC CGN3 ON GRP3.CATGROUP_ID = CGN3.CATGROUP_ID
		LEFT JOIN CATGRPREL REL3 ON REL3.CATGROUP_ID_CHILD = GRP3.CATGROUP_ID
		LEFT JOIN CATGROUP GRP2 ON REL3.CATGROUP_ID_PARENT = GRP2.CATGROUP_ID
		LEFT JOIN CATGRPDESC CGN2 ON GRP2.CATGROUP_ID = CGN2.CATGROUP_ID
		LEFT JOIN CATGRPREL REL2 ON REL2.CATGROUP_ID_CHILD = GRP2.CATGROUP_ID
		LEFT JOIN CATGROUP GRP1 ON REL2.CATGROUP_ID_PARENT = GRP1.CATGROUP_ID
		LEFT JOIN CATGRPDESC CGN1 ON GRP1.CATGROUP_ID = CGN1.CATGROUP_ID
		LEFT JOIN X_SALES_CATALOG_COND XSCC ON XSCC.CATGROUP_ID = GRP3.CATGROUP_ID
		WHERE
		GRP3.FIELD1 = 2
		AND GRP3.FIELD2=3
		<!--
		AND CGN3.DISPLAY=1 AND CGN1.DISPLAY=1 AND CGN2.DISPLAY=1
		-->
		AND CGN3.DISPLAY !=0 AND CGN1.DISPLAY !=0 AND CGN2.DISPLAY !=0 
		AND GRP3.MARKFORDELETE=0 AND GRP1.MARKFORDELETE=0 AND
		GRP2.MARKFORDELETE=0
		ORDER BY GRP1.RANK, GRP2.RANK, GRP3.RANK
	</select>
	
	<select id="getAllLevel3CatalogByDB2" parameterType="java.lang.Long"
		resultMap="getAllLevel3CatalogByDB_BaseResultMap">
		SELECT
		GRP3.CATGROUP_ID CLASS_ID,
		<!-- GRP3.IDENTIFIER CLASS_CODE, -->
		CGN3.NAME CLASS_NAME,
		GRP3.RANK CLASS_RANK,
		XSCC.FIELD3 CLASS_PROVIDER_CODE,
		GRP1.CATGROUP_ID PAR_CLASS1_ID,
		GRP2.CATGROUP_ID PAR_CLASS2_ID,
		<!-- GRP1.IDENTIFIER PAR_CLASS1_CODE, -->
		<!-- GRP2.IDENTIFIER PAR_CLASS2_CODE, -->
		CGN1.NAME PAR_CLASS1_NAME,
		CGN2.NAME PAR_CLASS2_NAME,
		GRP1.RANK PAR_CLASS1_RANK ,
		GRP2.RANK PAR_CLASS2_RANK
		FROM CATGROUP GRP3
		LEFT JOIN CATGRPDESC CGN3 ON GRP3.CATGROUP_ID = CGN3.CATGROUP_ID
		LEFT JOIN CATGRPREL REL3 ON REL3.CATGROUP_ID_CHILD = GRP3.CATGROUP_ID
		LEFT JOIN CATGROUP GRP2 ON REL3.CATGROUP_ID_PARENT = GRP2.CATGROUP_ID
		LEFT JOIN CATGRPDESC CGN2 ON GRP2.CATGROUP_ID = CGN2.CATGROUP_ID
		LEFT JOIN CATGRPREL REL2 ON REL2.CATGROUP_ID_CHILD = GRP2.CATGROUP_ID
		LEFT JOIN CATGROUP GRP1 ON REL2.CATGROUP_ID_PARENT = GRP1.CATGROUP_ID
		LEFT JOIN CATGRPDESC CGN1 ON GRP1.CATGROUP_ID = CGN1.CATGROUP_ID
		LEFT JOIN X_SALES_CATALOG_COND XSCC ON XSCC.CATGROUP_ID = GRP3.CATGROUP_ID
		WHERE
		GRP3.FIELD1 = 2
		AND GRP3.FIELD2=3
<!-- 		AND CGN3.DISPLAY=1 AND CGN1.DISPLAY=1 AND CGN2.DISPLAY=1 -->
		AND GRP3.MARKFORDELETE=0 AND GRP1.MARKFORDELETE=0 AND
		GRP2.MARKFORDELETE=0
		ORDER BY GRP1.RANK, GRP2.RANK, GRP3.RANK
	</select>

</mapper>